---
slug: react1
title: React-学习记录
author: lightyisu
author_title: 
author_url: https://github.com/lightyisu
author_image_url: https://tvax4.sinaimg.cn/crop.0.0.1002.1002.1024/d1bdec9fly8gkzcigbeltj20ru0ruabm.jpg?KID=imgbed,tva&Expires=1606556341&ssig=Cu95rZ4khr
tags: [React,redux]
---
React和Redux

<!--truncate-->

#### FLUX的简单构造

**View.js**

```js
import MyButton from './MyButton'
import {Component} from "react";
import {Dispatcher} from  'flux'
const appDispatcher=new Dispatcher();

const EventEmitter=require('events').EventEmitter;
let ListStore = Object.assign({}, EventEmitter.prototype, {
   items: ['a'],
   getAll() {

      return this.items
   },
   emitChange() {

      this.emit('change')
   },
    addItem(text){
      this.items.push(text)
    },
   addChangeListener(callback){
      this.on('change',callback)
   }
});

//DISPATCHER REGISTER(The exact way of change Data)
appDispatcher.register((action)=>{
   switch (action.actionType){
      case 'ADD_LIST':
      ListStore.addItem(action.text);
      ListStore.emitChange();
      break;
      default:
         return null;
   }
})

class View extends Component{
   constructor(props) {
      super(props);
      this.state={items:ListStore.getAll()}
      this.addNewItem=this.addNewItem.bind(this)
   }
   componentDidMount() {
      ListStore.addChangeListener(()=>{
         this.handleChange()
      })
   }
   addNewItem(text){
      appDispatcher.dispatch({
         actionType:'ADD_LIST',
         text:'dw2'
      })
   }
   handleChange(){
    this.setState({
       items:ListStore.getAll() //GET THE LATEST DATA TO MAKE REACT
    })
   }
   render() {
      return (
          <>
             {this.state.items.map((item,index)=>{return <p key={index}>{item}</p>})}
             <MyButton onClick={this.addNewItem}/>

          </>
          )
   }
}
export default View
```

**MyButton.js**

```js
function MyButton(props){
  return(
    <button onClick={props.onClick}>nihao</button>
  )
}


export default MyButton

```

来自:http://www.ruanyifeng.com/blog/2016/01/flux.html (flux-阮一峰)



## 容器组件（Smart/Container Components）和展示组件（Dumb/Presentational Components）

索引自:

[React 之容器组件和展示组件相分离解密](https://segmentfault.com/a/1190000006845396)

**不区分容器和展示组件**

```js
import {Component} from 'react'

class CommentList extends Component {
    constructor(props) {
        super(props);
        this.state = {
            comments: []
        }
    }
    componentDidMount() {
       //模拟获取请求
        setTimeout(() => {
            this.setState({
                comments: [
                    {body: 'The story nice', author: 'john'},
                    {body: 'React is real tool', author: 'evan'},
                    {body: 'Good tool!', author: 'jane'}]
            })
        }, 2000)
    }

    render() {
        // map(callback(@comment-item)=>{}) real arguments pass
        return <ul>{this.state.comments.map(this.renderComments)}</ul>
    }

    renderComments({body, author}) {
        return <li>{body}-{author}</li>
    }
}

export default CommentList
```

缺点：CommentList过分依赖于写定数据 无法复用

**分离容器组件与展示组件**

*容器组件 CommentListContainer.js*

```js
import {Component } from 'react'
import CommentList from './CommentList'
class  CommentListContainer extends  Component{
   constructor(props) {
      super(props);
      this.state={
         comments:[]
      }
   }
   // Mock Fetch the data
   componentDidMount() {
      setTimeout(()=>{
         this.setState({
            comments:[
               {body: 'The story nice', author: 'john'},
               {body: 'React is real tool', author: 'evan'},
               {body: 'Good tool!', author: 'jane'}
            ]
         })
      },2000)
   }
   render() {
      return <CommentList comments={this.state.comments} />
   }
}
export default  CommentListContainer

```

负责展示数据层

*展示组件 CommentList.js*

```js
import {Component} from 'react'
class CommentList extends  Component{
    render() {
        return <ul>{this.props.comments.map(this.renderComment)}</ul>
    }
    renderComment({body,author}){
        return <li>{body}-{author}</li>
    }
}
export  default  CommentList

```

#### The terser redux example

```jsx
import {createStore} from 'redux'
import {Component} from 'react'
//原始的state=====>defaultState
const defaultState=0
const add=()=>{
    return{
        type:'ADD_COUNT'
    }
}
const minus=()=>{
    return{
        type:'MINUS_COUNT'
    }
}
const reducers=(state=defaultState,action)=>{
    switch (action.type){
        case 'ADD_COUNT':
            return state+1;
        case 'MINUS_COUNT':
            return state-1;
        default:
            return state;
    }
}
const store=createStore(reducers);

function CounterWidget({count}){
    return( <>
        <h1>{count}</h1>
        <button onClick={()=>{store.dispatch(add())}}>+</button>
        <button onClick={()=>{store.dispatch(minus())}}>-</button>
    </>)
}
class Counter extends Component{
    constructor(props) {
        super(props);
        this.state={
            countNum:store.getState()
        }
    }
    componentDidMount() {
        store.subscribe(()=>{
            this.setState({
                countNum:store.getState()
            })
        })
    }

    render() {
        return (
            <CounterWidget count={this.state.countNum}/>
        )
    }
}
export default Counter

```

简洁的计时器 redux案例